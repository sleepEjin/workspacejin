<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="BoardMapper">
	<!-- resultMap : 조회된 resultSSet의 결과를 특징 객체에 맵핑할 맵핑정보를 기술하는 것 -->
	<resultMap id="boardResultMap" type="Board">
	<result column="BOARD_NO" property="boardNo"/>
	<result column="CATEGORY_NAME" property="categoryName"/>
	<result column="BOARD_TITLE" property="boardTitle"/>
	<result column="MEMBER_ID" property="memberId"/>
	<result column="COUNT" property="count"/>
	</resultMap>
<!-- 
	select문 사용시
	<select id="sql문 식별자" resultType="결과타입(별칭)" | resultMap="직접맵핑한 resultMap의 id">
    select문 (select * from Blog where id = #{id})
  </select>
 -->
 	<select id="selectAllBoardCount" resultType="_int">
 		SELECT COUNT(*)
 			FROM BOARD
 			WHERE STATUS='Y'
 	</select>
 	<select id="selectAllBoard" resultMap="boardResultMap">
		     SELECT  BOARD_NO, 
	                CATEGORY_NAME,
	                BOARD_TITLE,
	                MEMBER_ID,
	                COUNT,
	                TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE"
		        FROM BOARD B
		        JOIN CATEGORY USING(CATEGORY_NO)
		        JOIN MEMBER M ON(BOARD_WRITER = MEMBER_NO)
		        WHERE B.STATUS = 'Y'
		        AND BOARD_TYPE = 1
		        ORDER BY BOARD_NO DESC
 	</select>
 	<select id="searchBoardCount" resultType="_int">
 		SELECT COUNT(*)
 			FROM BOARD
 			JOIN MEMBER ON(BOARD_WRITER = MEMBER_NO)
 			WHERE STATUS='Y'
 			<choose>
 				<when test="condition =='writer'">
 					AND MEMBER_ID
 				</when>
 				<when test="condition =='writer'">
 					AND BOARD_TITLE
 				</when>
 				<otherwise>
 					AND BOARD_CONTENT
 				</otherwise>
 			</choose>
 			LIKE '%#{keyword}%'
 	</select>
 	<select id="searchBoard" resultMap="boardResultMap">
		     SELECT  BOARD_NO, 
	                CATEGORY_NAME,
	                BOARD_TITLE,
	                MEMBER_ID,
	                COUNT,
	                TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE"
		        FROM BOARD B
		        JOIN CATEGORY USING(CATEGORY_NO)
		        JOIN MEMBER M ON(BOARD_WRITER = MEMBER_NO)
		        WHERE B.STATUS = 'Y'
		        <choose>
		        <when test="condition =='writer'">
 					AND MEMBER_ID
 				</when>
 				<when test="condition =='writer'">
 					AND BOARD_TITLE
 				</when>
 				<otherwise>
 					AND BOARD_CONTENT
 				</otherwise>
 			</choose>
 			LIKE '%#{keyword}%'
		        ORDER BY BOARD_NO DESC
 	</select>
 	
</mapper>